# hosAgent v0.0.36 (2026-01-04)

## 变更概览

- **iFlow 接入**：新增 OpenAI 兼容的 iFlow Provider 与 GLM-4.6 文本模型，支持思考模式和工具调用。
- **智谱旗舰模型**：新增 GLM-4.7 旗舰代码模型，补充 reasoning toggle 并同步前后端模型枚举。
- **模型与工具重构**：拆分模型加载器并强化思考能力校验；工具调用执行器模块化，保留推理内容、去重流式工具事件。
- **流式与文档优化**：Stream/SSE 解析兼容 data: 变体与 tool_calls，修正 reasoning→content 顺序；README 切换 pnpm 并新增 iFlow Key 引导。

## 详情

### Added
- **iFlow Provider 与 GLM-4.6**：新增 OpenAI 兼容 Provider 类、模型定义与默认配置，映射 thinking.type/工具参数，前端 AI 配置面板提供 iFlow API Key 跳转。
- **智谱 GLM-4.7**：增加旗舰代码模型定义，声明 reasoning 能力与价格/上下文信息，前后端模型类型、列表与展示同步。

### Changed
- **模型加载器重构**：拆分为 defineModel、providerDefaults、constraintsMerger、reasoningProcessor/Validator，统一 Provider 默认值、文件约束合并与思考档位校验，保留原导出兼容。
- **工具调用执行器**：拆分 executor 模块（loopHandler/streamHandler/messageBuilder/executeTools），保留用户消息与 reasoning_content 回传，工具调用去重并限制最大轮次常量化，流式循环输出工具开始/结果事件。
- **流式兼容性**：StreamParser 支持 `data:`/`data: ` 写法并合并根级 tool_calls，响应处理在内容开始前结束 reasoning，服务层接入 iFlow Provider 的 chat/stream 流程。

### Documentation
- README/前端 README 切换 pnpm 工作流，更新 Provider 能力表（iFlow、GLM-4.7），AIConfig 增加 iFlow Key 指引，Agent Doctor 流程文档补充多 Provider 描述。

## 备注
- iFlow GLM-4.6 暂为文本模型，如传入多模态内容会记录警告并忽略媒体；工具调用循环最多 15 轮，若工具流存在则抑制同轮最终内容输出。

## Technical Details
- Commit: `027204d` - feat(provider): 接入 iFlow 与 GLM-4.7 并重构工具调用 (2026-01-04 02:34)
