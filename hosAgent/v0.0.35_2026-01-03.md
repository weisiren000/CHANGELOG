# hosAgent v0.0.35 (2026-01-03)

## 变更概览

- **Markdown 渲染系统**：新增完整的渲染器组件架构，支持代码块、LaTeX 数学公式、Mermaid 图表的即时渲染。
- **KaTeX 集成**：集成 KaTeX 库，实现高性能的数学公式渲染，支持行内和块级 LaTeX 语法。
- **聊天体验优化**：重构 ChatBubble、ThinkBubble 等组件样式，支持更丰富的内容类型展示。
- **流式处理增强**：streamHandler 支持更细粒度的内容类型识别和渲染管道。

## 详情

### Added

- **渲染器组件系统** (`frontend/src/components/chat/renderers/`)
  - 新增 `MarkdownRenderer`：统一的 Markdown 渲染容器，支持代码高亮、LaTeX、Mermaid。
  - 新增 `CodeBlock`：代码块渲染器，支持语法高亮和复制功能。
  - 新增 `LatexBlock`：LaTeX 公式渲染器，支持行内和块级数学公式。
  - 新增 `MermaidBlock`：Mermaid 图表渲染器，支持流程图、时序图等。
- **LaTeX 处理管道** (`frontend/src/components/chat/renderers/latex/`)
  - 新增完整的 LaTeX 解析、转换和渲染管道。
  - 支持 11 阶段文档转换：文档头提取、章节转换、列表转换、图表转换、表格转换、引用转换等。
  - 集成 `marked` 扩展，实现 LaTeX 到 Markdown 的智能转换。
- **专用样式文件** (`frontend/src/app/styles/markdown/`)
  - 新增 `code-block.css`：代码块专用样式，支持深色主题和语法高亮。
  - 新增 `latex.css`：LaTeX 公式专用样式，优化数学符号显示。
  - 新增 `mermaid.css`：Mermaid 图表专用样式，支持响应式布局。

### Changed

- **依赖升级**
  - `@ant-design/x`：从 v2.0.0 升级至 v2.1.0，获得更好的 Markdown 组件支持。
  - 新增 `katex@^0.16.27`：实现高性能数学公式渲染。
- **聊天组件重构** (`frontend/src/components/chat/`)
  - `ChatBubble`：优化内容渲染逻辑，支持多种内容类型（text、markdown、latex、mermaid）。
  - `ThinkBubble`：改进思考内容样式，支持嵌套 Markdown 渲染。
  - `ToolCallBubble`：优化工具调用结果的展示方式。
- **流式处理增强** (`frontend/src/stores/chat/utils/streamHandler.ts`)
  - 新增 `contentType` 识别：自动区分 `text`、`markdown`、`latex`、`mermaid` 等内容类型。
  - 优化流式事件处理：支持 `code_block`、`latex_block`、`mermaid_block` 等新事件类型。
  - 改进状态管理：新增 `currentBlock`、`currentCodeBlock` 等状态追踪。
- **样式优化** (`frontend/src/app/styles/`)
  - `chat.css`：重构聊天气泡样式，支持更复杂的内容布局。
  - `think.css`：优化思考模式显示效果，增强可读性。
  - `base.css`、`tokens.css`：调整基础样式变量，统一视觉风格。

### Technical

- **后端工具增强** (`backend/src/core/provider/tools/`)
  - 优化 `time.ts` 工具实现，增强错误处理和类型安全。
  - 提升 `executor.ts` 的工具调用性能和稳定性。
  - 新增完整的单元测试覆盖 (`time.test.ts`, `executor.test.ts`)。

## 备注

- 本次更新大幅提升了聊天界面的内容表现力，用户可以直观地查看代码、数学公式和图表。
- KaTeX 相比 MathJax 具有更快的渲染速度，显著改善了包含大量数学公式的场景的用户体验。
- 模块化的渲染器架构为未来添加更多内容类型（如 3D 模型、交互式组件）打下了基础。

## Technical Details

- Commit: `91f9b18` - feat(frontend): 实现完整的 Markdown 渲染系统并优化聊天体验 (2026-01-03 08:06:24)
